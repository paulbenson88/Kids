<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Numberblock 80 ‚Äî Swipe Gallery</title>
  <style>
    :root {
      --bg: #0a0a0a;
      --fg: #f5f5f5;
      --muted: #9aa0a6;
      --accent: #6ee7b7;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    }
    header {
      position: fixed;
      top: env(safe-area-inset-top);
      left: 0; right: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: .5rem;
      padding: .6rem .9rem;
      background: linear-gradient(180deg, rgba(0,0,0,.6), rgba(0,0,0,0));
      z-index: 5;
      pointer-events: none;
    }
    header .title {
      font-weight: 600;
      letter-spacing: .2px;
      pointer-events: auto;
    }
    header .actions { display: flex; gap: .5rem; pointer-events: auto; }
    button, .btn {
      border: 1px solid rgba(255,255,255,.2);
      background: rgba(255,255,255,.06);
      color: var(--fg);
      border-radius: 12px;
      padding: .5rem .7rem;
      font-size: .95rem;
      cursor: pointer;
      backdrop-filter: blur(10px);
    }
    button:active { transform: translateY(1px); }
    input[type="file"] { display: none; }

    /* Scroll-snap full-screen slides */
    .scroller {
      height: 100vh;
      overflow-y: auto;
      scroll-snap-type: y mandatory;
      -webkit-overflow-scrolling: touch;
    }
    .slide {
      position: relative;
      scroll-snap-align: start;
      height: 100vh;
      width: 100%;
      display: grid;
      place-items: center;
      padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
    }
    .slide img, .slide video {
      max-width: 100%;
      max-height: 100%;
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #111;
      border: 0;
      user-select: none;
      -webkit-user-drag: none;
    }
    .index-badge {
      position: absolute;
      bottom: calc(env(safe-area-inset-bottom) + 12px);
      right: 12px;
      background: rgba(0,0,0,.5);
      padding: .35rem .55rem;
      border-radius: 999px;
      font-size: .8rem;
      color: var(--muted);
    }
    .empty {
      height: 100vh; display: grid; place-items: center; text-align: center; padding: 2rem;
      color: var(--muted);
    }
    .hint {
      font-size: .95rem; line-height: 1.4;
      max-width: 28rem; margin: 0 auto;
    }
    .accent { color: var(--accent); }
    .thumbs {
      position: fixed;
      inset: auto 0 0 0;
      background: rgba(10,10,10,.92);
      border-top: 1px solid rgba(255,255,255,.12);
      display: none;
      gap: .5rem;
      padding: .6rem .6rem calc(.6rem + env(safe-area-inset-bottom));
      overflow-x: auto;
      white-space: nowrap;
      z-index: 6;
    }
    .thumbs.open { display: flex; }
    .thumbs img {
      height: 64px; width: auto; border-radius: 8px; cursor: pointer; opacity: .66;
      border: 1px solid rgba(255,255,255,.15);
    }
    .thumbs img.active { opacity: 1; outline: 2px solid var(--accent); }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
  </style>
</head>
<body>
  <header>
    <div class="title">Numberblock 80 ‚Äî Gallery</div>
    <div class="actions">
      <label for="filePicker" class="btn" title="Load pictures from your device">Load photos</label>
      <button id="toggleThumbs" class="btn" title="Toggle thumbnail strip">Thumbnails</button>
    </div>
  </header>

  <!-- Thumbnail strip (optional) -->
  <div id="thumbs" class="thumbs" aria-hidden="true"></div>

  <main id="scroller" class="scroller" aria-live="polite"></main>

  <div class="empty" id="emptyState">
    <div class="hint">
      <div style="font-size:1.2rem;margin-bottom:.4rem">Drop in your <span class="accent">Numberblock 80</span> pics üì∏</div>
      <p>Swipe <strong>top ‚Üí bottom</strong> to move through full‚Äëscreen slides.</p>
      <p><strong>3 ways to add images:</strong></p>
      <ol style="text-align:left;max-width:26rem;margin:0 auto;padding-left:1.2rem">
        <li><label for="filePicker" class="accent" style="cursor:pointer;text-decoration:underline">Tap ‚ÄúLoad photos‚Äù</label> and pick files from your device.</li>
        <li>Drag & drop files into this window.</li>
        <li>Add image URLs in the code (see <code>IMAGE_SOURCES</code> below) or pass <code>?urls=...</code> in the address bar.</li>
      </ol>
    </div>
  </div>

  <input id="filePicker" type="file" accept="image/*,video/*" multiple />

  <script>
    // 1) STATIC MODE: Add direct links here (local paths or URLs). Examples included.
    //    Replace with your own URLs or filenames placed in ./images/.
    const IMAGE_SOURCES = [
      // "./images/nb80-1.jpg",
      // "./images/nb80-2.png",
      // "https://example.com/your/numberblock80.jpg",
    ];

    // 2) Optional: auto-load from images.json (if present) ‚Äî ignored if fetch fails.
    async function loadFromManifest() {
      try {
        const res = await fetch("./images.json", { cache: "no-store" });
        if (!res.ok) return [];
        const list = await res.json();
        if (Array.isArray(list)) return list;
      } catch (_) {}
      return [];
    }

    const scroller = document.getElementById("scroller");
    const emptyState = document.getElementById("emptyState");
    const filePicker = document.getElementById("filePicker");
    const thumbs = document.getElementById("thumbs");
    const toggleThumbsBtn = document.getElementById("toggleThumbs");

    function parseUrlsParam() {
      const p = new URLSearchParams(location.search).get("urls");
      if (!p) return [];
      // support comma-separated and newline-separated
      return p.split(/[\n,]/).map(s => s.trim()).filter(Boolean);
    }

    function makeSlide(src, index, total) {
      const slide = document.createElement("section");
      slide.className = "slide";
      let media;
      if (/\.(mp4|webm|mov|m4v)$/i.test(src)) {
        media = document.createElement("video");
        media.src = src;
        media.controls = true;
        media.playsInline = true;
        media.preload = "metadata";
      } else {
        media = document.createElement("img");
        media.src = src;
        media.loading = "lazy";
        media.alt = "Numberblock 80 image " + (index + 1);
      }
      slide.appendChild(media);

      const badge = document.createElement("div");
      badge.className = "index-badge";
      badge.textContent = (index + 1) + " / " + total;
      slide.appendChild(badge);
      return slide;
    }

    function renderThumb(src, index) {
      // Thumbs are images only; videos show a generic box
      const t = document.createElement("img");
      t.src = src;
      t.alt = "Thumb " + (index + 1);
      t.addEventListener("click", () => {
        const target = scroller.children[index];
        if (target) target.scrollIntoView({ behavior: "smooth", block: "start" });
      });
      return t;
    }

    function updateActiveThumb() {
      const slides = [...scroller.children];
      const rects = slides.map(s => s.getBoundingClientRect());
      const idx = rects.reduce((best, r, i) => {
        const visible = Math.max(0, Math.min(window.innerHeight, r.bottom) - Math.max(0, r.top));
        return visible > best.max ? { max: visible, i } : best;
      }, { max: -1, i: 0 }).i;
      [...thumbs.children].forEach((img, i) => img.classList.toggle("active", i === idx));
    }

    function populate(sources) {
      scroller.innerHTML = "";
      thumbs.innerHTML = "";
      if (!sources.length) {
        emptyState.style.display = "grid";
        thumbs.classList.remove("open");
        return;
      }
      emptyState.style.display = "none";

      sources.forEach((src, i) => {
        scroller.appendChild(makeSlide(src, i, sources.length));
        if (!/\.(mp4|webm|mov|m4v)$/i.test(src)) {
          thumbs.appendChild(renderThumb(src, i));
        } else {
          const placeholder = document.createElement("img");
          placeholder.alt = "Video " + (i+1);
          placeholder.src = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='120' height='80'><rect width='100%' height='100%' fill='#222'/><polygon points='45,25 90,40 45,55' fill='#bbb'/></svg>`);
          thumbs.appendChild(placeholder);
        }
      });
      updateActiveThumb();
    }

    // Drag & drop support
    window.addEventListener("dragover", e => { e.preventDefault(); });
    window.addEventListener("drop", e => {
      e.preventDefault();
      if (!e.dataTransfer?.files?.length) return;
      handleFiles(e.dataTransfer.files);
    });

    // File picker
    filePicker.addEventListener("change", () => {
      if (filePicker.files?.length) handleFiles(filePicker.files);
    });

    function handleFiles(fileList) {
      const files = Array.from(fileList).filter(f => /image|video/.test(f.type));
      if (!files.length) return;
      Promise.all(files.map(file => new Promise(res => {
        const url = URL.createObjectURL(file);
        res(url);
      }))).then(urls => {
        populate(urls);
        thumbs.classList.add("open");
      });
    }

    // Toggle thumbnails
    toggleThumbsBtn.addEventListener("click", () => {
      thumbs.classList.toggle("open");
      thumbs.setAttribute("aria-hidden", thumbs.classList.contains("open") ? "false" : "true");
    });

    // Keyboard navigation
    window.addEventListener("keydown", (e) => {
      const current = document.elementFromPoint(window.innerWidth/2, window.innerHeight/2);
      const move = (dir) => {
        const slides = [...scroller.children];
        const rects = slides.map(s => s.getBoundingClientRect());
        const idx = rects.reduce((best, r, i) => {
          const visible = Math.max(0, Math.min(window.innerHeight, r.bottom) - Math.max(0, r.top));
          return visible > best.max ? { max: visible, i } : best;
        }, { max: -1, i: 0 }).i;
        const next = slides[idx + dir];
        if (next) next.scrollIntoView({ behavior: "smooth", block: "start" });
      };
      if (e.key === "ArrowDown" || e.key === "PageDown" || e.key === " ") { e.preventDefault(); move(1); }
      if (e.key === "ArrowUp"   || e.key === "PageUp") { e.preventDefault(); move(-1); }
      if (e.key.toLowerCase() === "t") toggleThumbsBtn.click();
    });

    // Observe scroll to highlight active thumb
    const obs = new IntersectionObserver(updateActiveThumb, { root: scroller, threshold: [0.25, 0.75] });
    const ro = new ResizeObserver(updateActiveThumb);
    ro.observe(document.body);
    scroller.addEventListener("scroll", () => { requestAnimationFrame(updateActiveThumb); });

    // Boot: combine priority = ?urls > images.json > IMAGE_SOURCES
    (async function boot() {
      const fromParam = parseUrlsParam();
      if (fromParam.length) { populate(fromParam); return; }
      const manifest = await loadFromManifest();
      if (manifest.length) { populate(manifest); return; }
      populate(IMAGE_SOURCES);
    })();
  </script>
</body>
</html>
